{% extends "base.html" %}
{% block title %}Cadastro Área Restrita{% endblock %}
{% block content %}
  <div class="container">
    <h2>Cadastro (Admin / Profissional)</h2>
    <form method="post"
          action="{{ url_for('cadastro_restrito') }}"
          enctype="multipart/form-data">
      <input type="text" name="nome" placeholder="Nome" required>
      <input type="email" name="email" placeholder="Email" required>
      <input type="password" name="senha" placeholder="Senha" required>

      <label for="tipo_user">Que tipo de usuário você é?</label>
      <select id="tipo_user" name="tipo_user" required>
        <option value="">Selecione...</option>
        <option value="profissional">Profissional</option>
        <option value="admin">Administrador</option>
      </select>

      <!-- Especialidades (apenas profissional) -->
      <div id="especialidades_group" style="display:none; margin-top: 0.5rem;">
        <input type="text" name="especialidades"
               placeholder="Especialidades (separadas por vírgula)">
      </div>

      <!-- Foto de perfil (apenas profissional) -->
      <div id="foto_perfil_group" style="display:none; margin-top: 0.5rem;">
        <label for="foto_perfil">Foto de perfil</label>
        <input type="file" id="foto_perfil" name="foto_perfil" accept="image/*">

        <!-- Pré-visualização -->
        <div style="margin-top: 0.5rem;">
          <img id="preview_foto"
               src="{{ url_for('static', filename='img/default-user.png') }}"
               alt="Pré-visualização da foto"
               style="max-width: 120px; border-radius: 50%;">
        </div>
      </div>

      <button type="submit">Cadastrar</button>
    </form>

    <p style="margin-top:1rem;">
      Já tem conta?
      <a href="{{ url_for('login_restrito') }}">Fazer login</a>
    </p>
  </div>

  <script>
    const selectTipo = document.getElementById('tipo_user');
    const espGroup   = document.getElementById('especialidades_group');
    const fotoGroup  = document.getElementById('foto_perfil_group');

    const inputFoto  = document.getElementById('foto_perfil');
    const preview    = document.getElementById('preview_foto');

    selectTipo.addEventListener('change', function () {
      if (this.value === 'profissional') {
        espGroup.style.display = 'block';
        fotoGroup.style.display = 'block';
      } else {
        espGroup.style.display = 'none';
        fotoGroup.style.display = 'none';
      }
    });

    // Pré-visualização da imagem escolhida
    inputFoto.addEventListener('change', function () {
      const file = this.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        preview.src = e.target.result;
      };
      reader.readAsDataURL(file);
    });
  </script>
{% endblock %}
