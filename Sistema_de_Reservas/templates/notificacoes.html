{% extends "base.html" %}
{% block title %}NotificaÃ§Ãµes{% endblock %}
{% block content %}
  <div class="container">
    <h2>NotificaÃ§Ãµes</h2>

    {% if notificacoes %}
      <div class="notificacoes-filtros">
        <a href="?filtro=nao_lidas" class="btn btn-secundario">ğŸ“¬ Somente nÃ£o lidas</a>
        <a href="?filtro=todas" class="btn btn-secundario">ğŸ“‹ Todas</a>
        {% if nao_lidas_count > 0 %}
          <a href="{{ url_for('marcar_todas_lidas') }}" class="btn btn-success" 
             onclick="return confirm('Marcar todas as {{ nao_lidas_count }} notificaÃ§Ã£o(Ãµes) nÃ£o lida(s) como lidas?');">
            âœ… Marcar todas como lidas ({{ nao_lidas_count }})
          </a>
        {% endif %}
      </div>

      <ul class="notificacoes-lista">
      {% for n in notificacoes %}
        <li class="notificacao-item {% if not n.lida %}nao-lida{% endif %}">
          <div class="notificacao-conteudo">
            <div class="notificacao-header">
              <div class="notificacao-data">{{ n.criado_em.strftime('%d/%m/%Y %H:%M') }}</div>
              {% if not n.lida %}
                <a href="{{ url_for('marcar_lida', notif_id=n.id) }}" 
                   class="btn-marcar-lida" 
                   title="Marcar como lida">
                  âœ“ Marcar como lida
                </a>
              {% else %}
                <span class="notificacao-lida-badge">âœ“ Lida</span>
              {% endif %}
            </div>
            <div class="notificacao-mensagem">{{ n.mensagem }}</div>
            
            {# BotÃµes de aprovaÃ§Ã£o / reprovaÃ§Ã£o visÃ­veis apenas para admins #}
            {% if user.perfil == 'admin' and n.tipo == 'pedido_admin' %}
              <div class="notificacao-acoes">
                <a href="{{ url_for('aprovar_admin', user_id=n.alvo_id) }}" class="btn btn-success">âœ… Aprovar</a>
                <a href="{{ url_for('reprovar_admin', user_id=n.alvo_id) }}" class="btn btn-danger">âŒ Reprovar</a>
              </div>
            {% elif user.perfil == 'admin' and n.tipo == 'pedido_profissional' %}
              <div class="notificacao-acoes">
                <a href="{{ url_for('aprovar_profissional', user_id=n.alvo_id) }}" class="btn btn-success">âœ… Aprovar</a>
                <a href="{{ url_for('reprovar_profissional', user_id=n.alvo_id) }}" class="btn btn-danger">âŒ Reprovar</a>
              </div>
            {% endif %}
          </div>
        </li>
      {% endfor %}
      </ul>
    {% else %}
      <div class="sem-notificacoes">
        <p>ğŸ“­ VocÃª nÃ£o possui notificaÃ§Ãµes no momento.</p>
      </div>
    {% endif %}
  </div>
{% endblock %}